# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–≤–æ–¥–∞ –æ–ø—Ü–∏–π —Å —Ü–µ–Ω–∞–º–∏

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/cities/arhangelsk/services/shinomontazh` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `PriceEmptyState` –≤–º–µ—Å—Ç–æ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ —Å –æ–ø—Ü–∏—è–º–∏ –∏ —Ü–µ–Ω–∞–º–∏.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `CityServiceContent.tsx`
- –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω —á–µ—Ä–µ–∑ `/api/website/options/{id}/` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–ø—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ –≥–æ—Ç–æ–≤—ã

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –û–ø—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API
2. –¶–µ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–ª—è –æ–ø—Ü–∏–π
3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ü–µ–Ω –ø–æ –≥–æ—Ä–æ–¥—É —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ü–µ–Ω—ã
4. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. –£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è `PriceEmptyState` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîç –≠—Ç–∞–ø 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### 1.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ó–∞–¥–∞—á–∞:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–∑–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `http://localhost:3000/cities/arhangelsk/services/shinomontazh`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - `[getServiceByCity] Raw API response:` - –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `options` –º–∞—Å—Å–∏–≤
   - `[getServiceByCity] Options in response:` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ –æ–ø—Ü–∏–π
   - `[getServiceByCity] Options length:` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```javascript
[getServiceByCity] Raw API response: {
  city: { id: ..., title: "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫", ... },
  service: { id: ..., title: "–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂", ... },
  options: [
    { id: 1, title: "–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞", ... },
    { id: 2, title: "–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ R13-R15", ... }
  ]
}
```

**–ï—Å–ª–∏ –æ–ø—Ü–∏–π –Ω–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint: `http://localhost:8001/api/website/cities/arhangelsk/services/shinomontazh/`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (is_active, –Ω–∞–ª–∏—á–∏–µ —Ü–µ–Ω)

### 1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω –¥–ª—è –æ–ø—Ü–∏–π

**–ó–∞–¥–∞—á–∞:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ü–µ–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - `[getServiceByCity] Option {id} ({title}):` - –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø—Ü–∏–∏
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: `allPrices`, `cityPrices`, `prices`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```javascript
[getServiceByCity] Option 1 (–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–µ—Å–∞): {
  allPrices: 3,  // –í—Å–µ —Ü–µ–Ω—ã –æ–ø—Ü–∏–∏ (–≤—Å–µ –≥–æ—Ä–æ–¥–∞)
  cityPrices: 2, // –¶–µ–Ω—ã –¥–ª—è –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞
  prices: [
    { id: 181, amount: "500.00", technic_category_title: "–ì—Ä—É–∑–æ–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å", city_slug: "arhangelsk" },
    { id: 182, amount: "300.00", technic_category_title: "–õ–µ–≥–∫–æ–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å", city_slug: "arhangelsk" }
  ]
}
```

**–ï—Å–ª–∏ —Ü–µ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint: `http://localhost:8001/api/website/options/{id}/`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `prices`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `city_slug`

**–ï—Å–ª–∏ `cityPrices: 0`:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `city_slug` –≤ —Ü–µ–Ω–∞—Ö —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `citySlug` –∏–∑ URL
- –í–æ–∑–º–æ–∂–Ω–æ, –≤ API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç slug (–Ω–∞–ø—Ä–∏–º–µ—Ä, "arhangelsk" vs "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫")

### 1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

**–ó–∞–¥–∞—á–∞:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `CityServiceContent.tsx`:
```typescript
console.log('[CityServiceContent] options:', options)
console.log('[CityServiceContent] options length:', options?.length)
console.log('[CityServiceContent] first option:', options?.[0])
console.log('[CityServiceContent] first option prices:', options?.[0]?.prices)
```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:
```typescript
console.log('[CityServiceContent] grouped:', grouped)
console.log('[CityServiceContent] uncategorized:', uncategorized)
console.log('[CityServiceContent] categoryNames:', categoryNames)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `options` - –º–∞—Å—Å–∏–≤ —Å –æ–ø—Ü–∏—è–º–∏
- –ö–∞–∂–¥–∞—è –æ–ø—Ü–∏—è –∏–º–µ–µ—Ç `prices` –º–∞—Å—Å–∏–≤
- `grouped` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –æ–ø—Ü–∏—è–º–∏
- `categoryNames` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

---

## üõ†Ô∏è –≠—Ç–∞–ø 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### 2.1 –ü—Ä–æ–±–ª–µ–º–∞: –û–ø—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `options.length === 0`
- `PriceEmptyState` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏—è:**

#### –†–µ—à–µ–Ω–∏–µ A: –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoint
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ curl
curl http://localhost:8001/api/website/cities/arhangelsk/services/shinomontazh/
```

#### –†–µ—à–µ–Ω–∏–µ B: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
```typescript
// –í cities.service.ts
getServiceByCity: async (citySlug, serviceSlug) => {
  try {
    const response = await Service.websiteCitiesServicesRetrieve(citySlug, serviceSlug)
    
    if (!response?.options || response.options.length === 0) {
      console.warn('[getServiceByCity] No options returned from API')
      return {
        ...response,
        options: []
      }
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    console.error('[getServiceByCity] Error:', error)
    throw ApiError.fromUnknown(error)
  }
}
```

### 2.2 –ü—Ä–æ–±–ª–µ–º–∞: –¶–µ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û–ø—Ü–∏–∏ –µ—Å—Ç—å, –Ω–æ `prices` –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- –í –ª–æ–≥–∞—Ö `cityPrices: 0`

**–†–µ—à–µ–Ω–∏—è:**

#### –†–µ—à–µ–Ω–∏–µ A: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ—Ä–æ–¥—É
```typescript
// –í cities.service.ts, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
const cityPrices = optionDetail.prices.filter(
  (price: OptionPrice) => {
    const matches = price.city_slug === citySlug
    if (!matches && process.env.NODE_ENV === 'development') {
      console.warn(`[getServiceByCity] Price city_slug mismatch:`, {
        priceCitySlug: price.city_slug,
        expectedCitySlug: citySlug,
        optionId: option.id
      })
    }
    return matches
  }
)
```

#### –†–µ—à–µ–Ω–∏–µ B: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è city_slug
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é slug
function normalizeSlug(slug: string): string {
  return slug.toLowerCase().trim()
}

const cityPrices = optionDetail.prices.filter(
  (price: OptionPrice) => normalizeSlug(price.city_slug) === normalizeSlug(citySlug)
)
```

#### –†–µ—à–µ–Ω–∏–µ C: Fallback –Ω–∞ –≤—Å–µ —Ü–µ–Ω—ã (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
```typescript
// –í—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Ü–µ–Ω—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
if (cityPrices.length === 0 && optionDetail.prices.length > 0) {
  console.warn(`[getServiceByCity] No prices for city ${citySlug}, using all prices for debugging`)
  return {
    ...option,
    prices: optionDetail.prices, // –í—Ä–µ–º–µ–Ω–Ω–æ –≤—Å–µ —Ü–µ–Ω—ã
  }
}
```

### 2.3 –ü—Ä–æ–±–ª–µ–º–∞: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û–ø—Ü–∏–∏ –µ—Å—Ç—å, —Ü–µ–Ω—ã –µ—Å—Ç—å, –Ω–æ `categoryNames.length === 0`
- `grouped` –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç

**–†–µ—à–µ–Ω–∏—è:**

#### –†–µ—à–µ–Ω–∏–µ A: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ü–µ–Ω
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ groupOptionsByCategory
function groupOptionsByCategory(options: CityServiceOption[]) {
  console.log('[groupOptionsByCategory] Input options:', options)
  
  options.forEach(option => {
    console.log(`[groupOptionsByCategory] Option ${option.id}:`, {
      hasPrices: !!option.prices,
      pricesLength: option.prices?.length,
      prices: option.prices,
      hasLegacyPrice: !!option.price
    })
  })
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

#### –†–µ—à–µ–Ω–∏–µ B: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```typescript
// –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
option.prices.forEach(price => {
  console.log('[groupOptionsByCategory] Price:', {
    technic_category_title: price.technic_category_title,
    isTruthy: !!price.technic_category_title
  })
  
  if (price.technic_category_title) {
    categoriesInOption.add(price.technic_category_title)
    categorySet.add(price.technic_category_title)
  }
})
```

### 2.4 –ü—Ä–æ–±–ª–µ–º–∞: –£—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –Ω–æ `PriceEmptyState` –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

**–¢–µ–∫—É—â–µ–µ —É—Å–ª–æ–≤–∏–µ:**
```typescript
{!options || options.length === 0 || (categoryNames.length === 0 && uncategorized.length === 0) ? (
  <PriceEmptyState ... />
) : (
  <PriceAccordion ... />
)}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –µ—Å—Ç—å –æ–ø—Ü–∏–∏, –Ω–æ –æ–Ω–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –Ω–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–∏ –≤ uncategorized, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –£–ª—É—á—à–∏—Ç—å —É—Å–ª–æ–≤–∏–µ
const hasOptions = options && options.length > 0
const hasCategories = categoryNames.length > 0
const hasUncategorized = uncategorized.length > 0
const shouldShowEmpty = !hasOptions || (!hasCategories && !hasUncategorized)

{shouldShowEmpty ? (
  <PriceEmptyState message="–¶–µ–Ω—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–∏ –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ –ø–æ–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã.">
    <Button asChild>
      <Link href="/contacts">–£–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã</Link>
    </Button>
  </PriceEmptyState>
) : (
  <PriceAccordion ... />
)}
```

---

## ‚úÖ –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3.1 –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ë–∞–∑–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø—Ü–∏–∏
- [ ] –¶–µ–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø—Ü–∏–∏
- [ ] –¶–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–µ–º—É –≥–æ—Ä–æ–¥—É
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–µ
- [ ] –û–ø—Ü–∏–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ø–∞–¥–∞—é—Ç –≤ "–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏"
- [ ] –û–ø—Ü–∏–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ü–µ–Ω–∞–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
- [ ] –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö

### 3.2 –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–ø—Ü–∏–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–ø—Ü–∏–∏ —Å —Ü–µ–Ω–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ—Ö–Ω–∏–∫–∏
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–∫–∫–æ—Ä–¥–µ–æ–Ω —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏, –æ–ø—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–ø—Ü–∏–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–ø—Ü–∏–∏ —Å —Ü–µ–Ω–∞–º–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ—Ö–Ω–∏–∫–∏
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–∑–¥–µ–ª "–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏" —Å –æ–ø—Ü–∏—è–º–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–ø—Ü–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–¥–Ω–∞ –æ–ø—Ü–∏—è —Å —Ü–µ–Ω–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ü–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ü–µ–Ω–æ–π

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ—Ç –æ–ø—Ü–∏–π
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –æ–ø—Ü–∏–π
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `PriceEmptyState` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º

#### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û–ø—Ü–∏–∏ –±–µ–∑ —Ü–µ–Ω
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–ø—Ü–∏–∏ –µ—Å—Ç—å, –Ω–æ —Ü–µ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
- **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** Fallback –Ω–∞ legacy —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–ª–∏ –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

## üîß –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 4.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏

```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫–µ–ª–µ—Ç–æ–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω
{isLoading && !initialData ? (
  <div className="space-y-4">
    {[...Array(3)].map((_, i) => (
      <Skeleton key={i} className="h-20 w-full" />
    ))}
  </div>
) : (
  // ... –∞–∫–∫–æ—Ä–¥–µ–æ–Ω
)}
```

### 4.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω

```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –≤—Å–µ —Ü–µ–Ω—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
const optionsWithErrors = optionsWithAllPrices.filter(opt => 
  opt.prices.length === 0 && !opt.price
)

if (optionsWithErrors.length > 0 && process.env.NODE_ENV === 'development') {
  console.warn('[getServiceByCity] Options without prices:', optionsWithErrors)
}
```

### 4.3 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SWR –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω –æ–ø—Ü–∏–π
// –≠—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ useCityService, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫—ç—à –¥–ª—è —Ü–µ–Ω
```

### 4.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
// –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
// –ï—Å–ª–∏ –æ–ø—Ü–∏–π –º–Ω–æ–≥–æ (>20), –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ—Ä—Ü–∏—è–º–∏
const BATCH_SIZE = 10
const batches = []
for (let i = 0; i < baseOptions.length; i += BATCH_SIZE) {
  batches.push(baseOptions.slice(i, i + BATCH_SIZE))
}

const optionsWithAllPrices = []
for (const batch of batches) {
  const batchResults = await Promise.all(
    batch.map(async (option) => { /* ... */ })
  )
  optionsWithAllPrices.push(...batchResults)
}
```

---

## üìù –≠—Ç–∞–ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 5.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º:
1. –û–±–Ω–æ–≤–∏—Ç—å `PRICE_OPTIONS_LOGIC.md` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è"
3. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 5.2 –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
- –í `getServiceByCity` - –æ–±—ä—è—Å–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω
- –í `groupOptionsByCategory` - –æ–±—ä—è—Å–Ω–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
- –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ - –æ–±—ä—è—Å–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–°–Ω–∞—á–∞–ª–∞:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–≠—Ç–∞–ø 1)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ —Ç–µ—Ä—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ

2. **–ó–∞—Ç–µ–º:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≠—Ç–∞–ø 2)
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

3. **–ü–æ—Å–ª–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≠—Ç–∞–ø 3)
   - –ü—Ä–æ–π—Ç–∏ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–í –∫–æ–Ω—Ü–µ:** –£–ª—É—á—à–µ–Ω–∏—è (–≠—Ç–∞–ø 4-5)
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Options length: 0"

**–ü—Ä–∏—á–∏–Ω–∞:** API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø—Ü–∏–∏ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏—Ö –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint –Ω–∞–ø—Ä—è–º—É—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (is_active, –Ω–∞–ª–∏—á–∏–µ —Ü–µ–Ω)
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ API —Å–µ—Ä–≤–∏—Å

### –ü—Ä–æ–±–ª–µ–º–∞: "cityPrices: 0"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ `city_slug` –≤ —Ü–µ–Ω–∞—Ö –∏ –≤ URL

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç slug (lowercase, –¥–µ—Ñ–∏—Å—ã)
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é slug
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "categoryNames: []"

**–ü—Ä–∏—á–∏–Ω–∞:** –¶–µ–Ω—ã –Ω–µ –∏–º–µ—é—Ç `technic_category_title` –∏–ª–∏ –æ–Ω null

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ API –æ—Ç–≤–µ—Ç–µ
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Ö–Ω–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fallback –Ω–∞ legacy —Å—Ç—Ä—É–∫—Ç—É—Ä—É

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-29  
**–°—Ç–∞—Ç—É—Å:** üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

