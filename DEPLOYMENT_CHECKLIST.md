# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### üìù .env —Ñ–∞–π–ª—ã –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–î–ª—è production –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ Docker:**
- ‚ùå **–ù–ï –Ω—É–∂–µ–Ω** `.env` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **Docker build args** (—Å–º. `deploy/docker-compose.prod.yml`)
- ‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ `Dockerfile`

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `.env.local` –≤ `apps/frontend/` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)
- ‚úÖ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ `config/index.ts`

**–ü—Ä–∏–º–µ—Ä `.env.local` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
```env
# apps/frontend/.env.local
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_APP_DOMAIN=http://localhost:3000
NEXT_PUBLIC_APP_NAME=911
NEXT_PUBLIC_APP_ENV=development
```

**–í–∞–∂–Ω–æ:** 
- `.env.local` —É–∂–µ –≤ `.gitignore` - –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è
- –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker build args, –Ω–µ `.env` —Ñ–∞–π–ª—ã

---

### ‚úÖ 1. URL API –≤ –∫–æ–¥–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

- **–§–∞–π–ª:** `apps/frontend/src/lib/config/index.ts`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:** `NEXT_PUBLIC_API_URL`
- **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ Dockerfile:** `http://45.144.221.92` ‚úÖ

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- OpenAPI –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BASE URL + –ø—É—Ç—å
- –ü—É—Ç–∏ –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–ª–∏–µ–Ω—Ç–µ —É–∂–µ –≤–∫–ª—é—á–∞—é—Ç `/api/website/`
- –ù–∞–ø—Ä–∏–º–µ—Ä: `url: '/api/website/services/'` –≤ `Service.ts`
- –ò—Ç–æ–≥–æ–≤—ã–π URL: `http://45.144.221.92` + `/api/website/services/` = `http://45.144.221.92/api/website/services/` ‚úÖ

### ‚úÖ 2. Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤:**
- `deploy/docker/frontend/Dockerfile` - ARG `NEXT_PUBLIC_API_URL=http://45.144.221.92` ‚úÖ
- `deploy/docker-compose.prod.yml` - args —Å —Ç–µ–º –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º ‚úÖ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ –±–µ–∫–µ–Ω–¥-—Å–µ—Ä–≤–µ—Ä–µ (45.144.221.92)

### 1. –û–±–Ω–æ–≤–∏—Ç—å `.env.prod`

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 45.144.221.92
cd /path/to/backend

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env.prod
nano .env.prod
```

**–î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å:**
```env
ALLOWED_HOSTS=45.144.221.92,api.911.ru,www.911.ru,911.ru,89.169.1.53
CORS_ALLOWED_ORIGINS=http://45.144.221.92,http://89.169.1.53
```

### 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∫–µ–Ω–¥–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 45.144.221.92
docker compose --env-file .env.prod -f docker/docker-compose.prod.yml up -d --force-recreate web
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS
curl -H "Origin: http://89.169.1.53" \
     -H "Access-Control-Request-Method: GET" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS \
     http://45.144.221.92/api/website/services/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏:
# Access-Control-Allow-Origin: http://89.169.1.53
# Access-Control-Allow-Methods: GET, POST, OPTIONS, ...
```

---

## üöÄ –î–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (89.169.1.53)

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥

```bash
cd ~/projects/web_911
git fetch origin
git reset --hard origin/main
```

### 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `http://localhost:8000`, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
cd deploy

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f docker-compose.prod.yml down

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑ (—á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É)
docker rmi 911_frontend_prod 2>/dev/null || true

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (--no-cache –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–≤–µ–∂—É—é —Å–±–æ—Ä–∫—É)
docker-compose -f docker-compose.prod.yml build --no-cache frontend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f docker-compose.prod.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
docker-compose -f docker-compose.prod.yml exec frontend env | grep NEXT_PUBLIC
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º –æ–±—Ä–∞–∑–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º –æ–±—Ä–∞–∑–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL
docker-compose -f docker-compose.prod.yml exec frontend node -e "console.log('API URL:', process.env.NEXT_PUBLIC_API_URL)"
```

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤—Å–µ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `docker-compose.prod.yml` –≤ —Å–µ–∫—Ü–∏–∏ `build.args` —É–∫–∞–∑–∞–Ω `NEXT_PUBLIC_API_URL`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ `Dockerfile` –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ: `ARG NEXT_PUBLIC_API_URL=http://45.144.221.92`
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:
   ```bash
   NEXT_PUBLIC_API_URL=http://45.144.221.92 docker-compose -f docker-compose.prod.yml build --no-cache frontend
   ```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose -f docker-compose.prod.yml ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml logs -f frontend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–π—Ç
curl http://89.169.1.53/
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API –¥–æ—Å—Ç—É–ø–µ–Ω —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (89.169.1.53)
curl http://45.144.221.92/api/website/services/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å —É—Å–ª—É–≥–∞–º–∏
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä—ã—Ç—å `http://89.169.1.53/`
2. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ `http://45.144.221.92/api/website/...`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç CORS –æ—à–∏–±–æ–∫

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å–ª—É–≥–∏
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/services` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/cities` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥–æ—Ä–æ–¥–∞

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `CORS_ALLOWED_ORIGINS` –Ω–∞ –±–µ–∫–µ–Ω–¥–µ –≤–∫–ª—é—á–∞–µ—Ç `http://89.169.1.53`
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∫–µ–Ω–¥–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞: 404 Not Found –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ URL API –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `http://45.144.221.92/api/website/...`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–µ–∫–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω: `curl http://45.144.221.92/api/website/services/`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–µ–∫–µ–Ω–¥–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker-compose ps`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker-compose logs frontend`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ nginx –∑–∞–ø—É—â–µ–Ω: `docker-compose logs nginx`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã: `netstat -tulpn | grep 80`

### –ü—Ä–æ–±–ª–µ–º–∞: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `http://localhost:8000`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEXT_PUBLIC_API_URL` –Ω–µ –±—ã–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:**
   ```bash
   cd deploy
   docker-compose -f docker-compose.prod.yml down
   docker-compose -f docker-compose.prod.yml build --no-cache frontend
   docker-compose -f docker-compose.prod.yml up -d
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –æ–±—Ä–∞–∑–µ:**
   ```bash
   # –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
   docker-compose -f docker-compose.prod.yml exec frontend env | grep NEXT_PUBLIC_API_URL
   # –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: NEXT_PUBLIC_API_URL=http://45.144.221.92
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   - –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Console
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ `http://45.144.221.92/api/website/...`
   - –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –≤–∏–¥–∏—Ç–µ `localhost:8000`, –æ–±—Ä–∞–∑ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å

**–í–∞–∂–Ω–æ:** –í Next.js –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `NEXT_PUBLIC_*` –≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ **–≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏**. –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –±—ã–ª —Å–æ–±—Ä–∞–Ω –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (89.169.1.53)
- **URL:** `http://89.169.1.53/`
- **API URL –≤ –∫–æ–¥–µ:** `http://45.144.221.92` (BASE)
- **–ò—Ç–æ–≥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:** `http://45.144.221.92/api/website/...` ‚úÖ

### –ë–µ–∫–µ–Ω–¥ (45.144.221.92)
- **API URL:** `http://45.144.221.92/api/website/`
- **ALLOWED_HOSTS:** –≤–∫–ª—é—á–∞–µ—Ç `89.169.1.53` ‚úÖ
- **CORS_ALLOWED_ORIGINS:** –≤–∫–ª—é—á–∞–µ—Ç `http://89.169.1.53` ‚úÖ

